<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>星期天文案馆专属文案生成器</title>
    <link rel="preload" as="style" crossorigin
        href="https://fontsapi.zeoseven.com/498/main/result.css"
        onload="this.rel='stylesheet'"
        onerror="this.href='https://fontsapi-storage.zeoseven.com/498/main/result.css'" />
    <noscript>
        <link rel="stylesheet" href="https://fontsapi.zeoseven.com/498/main/result.css" />
    </noscript>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: "平方刘昂乐天体", "PingFang SC", "Microsoft YaHei", "SimSun", "宋体", sans-serif;
            background: linear-gradient(to bottom, #ffb3a7, #fedfe1, #fffafa);
            color: #5a3d3b;
            line-height: 1.6;
            min-height: 100vh;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }
        
        .main-title {
            font-weight: normal;
        }
        
        .container {
            max-width: 100%;
            min-height: 100vh;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            text-align: center;
            padding: 25px 15px 15px;
            position: relative;
            z-index: 10;
        }
        
        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #ff6b81;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        
        .tagline {
            font-size: 14px;
            color: #9d7c7b;
        }
        
        .page-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            padding: 0 15px;
        }
        
        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 15px 0;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
            overflow-y: auto;
        }
        
        .page.active {
            opacity: 1;
            visibility: visible;
        }
        
        .nav {
            background-color: #fff;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 -2px 15px rgba(0, 0, 0, 0.08);
            z-index: 100;
            padding: 10px 0;
            border-radius: 20px 20px 0 0;
        }
        
        .nav-item {
            text-align: center;
            flex: 1;
            padding: 5px 2px;
            font-size: 12px;
            color: #9d7c7b;
            position: relative;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .nav-item.active {
            color: #ff6b81;
        }
        
        .nav-item.active .nav-icon {
            transform: translateY(-3px);
            color: #ff6b81;
        }
        
        .nav-icon {
            font-size: 20px;
            margin-bottom: 3px;
            display: block;
            transition: all 0.3s;
        }
        
        .input-area {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .input-area::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #ff9e8d, #fedfe1);
        }
        
        .input-title {
            font-size: 14px;
            margin-bottom: 12px;
            color: #7a5a58;
            text-align: center;
        }
        
        .input-field {
            width: 100%;
            min-height: 70px;
            border: 2px solid #fedfe1;
            border-radius: 15px;
            padding: 12px;
            font-size: 16px;
            font-family: inherit;
            resize: none;
            margin-bottom: 15px;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.8);
        }
        
        .input-field:focus {
            outline: none;
            border-color: #ffb3a7;
            box-shadow: 0 0 0 3px rgba(255, 179, 167, 0.3);
        }
        
        .keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .keyword {
            background: linear-gradient(135deg, #ffb3a7, #ff9e8d);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(255, 179, 167, 0.4);
        }
        
        .keyword:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(255, 179, 167, 0.5);
        }
        
        .generate-btn {
            background: linear-gradient(135deg, #ff6b81, #ff4f6d);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            font-size: 14px;
            display: block;
            margin: 0 auto;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 8px rgba(255, 107, 129, 0.4);
        }
        
        .generate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(255, 107, 129, 0.5);
        }
        
        .generate-btn:active {
            transform: translateY(1px);
        }
        
        .results {
            margin-top: 20px;
            display: none;
        }
        
        .result-item {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 18px;
            margin-bottom: 18px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            position: relative;
            transform: translateY(20px);
            opacity: 0;
            animation: fadeInUp 0.5s forwards;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .result-text {
            margin-bottom: 18px;
            font-size: 16px;
            line-height: 1.6;
            color: #5a3d3b;
            position: relative;
            padding-left: 22px;
        }
        
        .result-text::before {
            content: """;
            position: absolute;
            left: 0;
            top: -5px;
            font-size: 24px;
            color: #ffb3a7;
        }
        
        /* 新增：网感文案标签样式（如#日常 #治愈） */
        .result-tag {
            display: inline-block;
            font-size: 12px;
            color: #ff6b81;
            background: rgba(255, 107, 129, 0.1);
            padding: 2px 8px;
            border-radius: 12px;
            margin-right: 6px;
            margin-top: 8px;
        }
        
        .result-actions {
            display: flex;
            justify-content: space-around;
            border-top: 1px solid #f8e5e5;
            padding-top: 15px;
        }
        
        .action-btn {
            background: none;
            border: none;
            color: #9d7c7b;
            font-size: 14px;
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .action-btn:hover {
            background: rgba(255, 179, 167, 0.1);
        }
        
        .action-btn i {
            margin-right: 5px;
            font-size: 16px;
        }
        
        .action-btn.active {
            color: #ff6b81;
        }
        
        .regenerate {
            background: linear-gradient(135deg, #ffb3a7, #ff9e8d);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 25px;
            font-size: 14px;
            display: block;
            margin: 25px auto;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(255, 179, 167, 0.4);
        }
        
        .regenerate:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(255, 179, 167, 0.5);
        }
        
        .footer {
            text-align: center;
            padding: 20px 0 15px;
            color: #9d7c7b;
            font-size: 12px;
            margin-top: auto;
        }
        
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #9d7c7b;
        }
        
        .empty-icon {
            font-size: 60px;
            margin-bottom: 20px;
            color: #ffd1c9;
            opacity: 0.7;
        }
        
        .empty-text {
            font-size: 16px;
            margin-bottom: 25px;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            margin: 0 auto 15px;
            border: 3px solid rgba(255, 179, 167, 0.3);
            border-radius: 50%;
            border-top-color: #ff6b81;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #7a5a58;
            font-size: 15px;
        }
        
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(90, 61, 59, 0.85);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .toast.show {
            opacity: 1;
            visibility: visible;
        }
        
        .saved-results {
            margin-top: 20px;
        }
        
        .page-title {
            font-size: 20px;
            text-align: center;
            margin-bottom: 20px;
            color: #ff6b81;
            font-weight: bold;
        }
        
        /* 响应式调整 */
        @media (max-width: 360px) {
            .logo {
                font-size: 24px;
            }
            
            .nav-icon {
                font-size: 18px;
            }
            
            .nav-item {
                font-size: 11px;
                padding: 5px 1px;
            }
            
            .input-field {
                min-height: 60px;
            }
            
            .keyword {
                font-size: 12px;
                padding: 5px 10px;
            }
            
            .generate-btn {
                padding: 8px 16px;
                font-size: 13px;
            }
            
            .page-title {
                font-size: 18px;
            }
            
            .result-text {
                font-size: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 简洁标题 -->
        <div class="header">
            <div class="logo main-title">星期天文案馆专属文案生成器</div>
            <div class="tagline">一键生成优质朋友圈文案</div>
        </div>
        
        <div class="page-container">
            <!-- 首页：生成文案 -->
            <div class="page active" id="home">
                <div class="input-area">
                    <div class="input-title">请输入关键词或选择下方推荐词</div>
                    <textarea class="input-field" placeholder="例如：自拍、时光、入秋、周末、咖啡..."></textarea>
                    
                    <!-- 新增网感关键词：覆盖更多社交场景 -->
                    <div class="keywords">
                        <div class="keyword">自拍时刻</div>
                        <div class="keyword">美好时光</div>
                        <div class="keyword">入秋心情</div>
                        <div class="keyword">周末日常</div>
                        <div class="keyword">咖啡续命</div>
                        <div class="keyword">citywalk</div>
                        <div class="keyword">宅家治愈</div>
                        <div class="keyword">美食打卡</div>
                    </div>
                    
                    <button class="generate-btn">生成文案</button>
                </div>
                
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">AI正在分析关键词并生成文案...</div>
                </div>
                
                <div class="results">
                    <!-- 生成的文案将显示在这里 -->
                </div>
                
                <button class="regenerate">重新生成</button>
            </div>
            
            <!-- 我的喜欢页面 -->
            <div class="page" id="likes">
                <div class="page-title">我的喜欢</div>
                
                <div class="saved-results" id="liked-results">
                    <!-- 喜欢的文案将显示在这里 -->
                </div>
                
                <div class="empty-state" id="liked-empty">
                    <div class="empty-icon">♥</div>
                    <div class="empty-text">暂无喜欢的文案</div>
                    <button class="generate-btn" onclick="switchPage('home')">去生成文案</button>
                </div>
            </div>
            
            <!-- 我的收藏页面 -->
            <div class="page" id="collections">
                <div class="page-title">我的收藏</div>
                
                <div class="saved-results" id="collected-results">
                    <!-- 收藏的文案将显示在这里 -->
                </div>
                
                <div class="empty-state" id="collected-empty">
                    <div class="empty-icon">☆</div>
                    <div class="empty-text">暂无收藏的文案</div>
                    <button class="generate-btn" onclick="switchPage('home')">去生成文案</button>
                </div>
            </div>
            
            <!-- 馆内推荐页面 -->
            <div class="page" id="recommendations">
                <div class="page-title">馆内推荐</div>
                
                <div class="saved-results" id="recommended-results">
                    <!-- 推荐的文案将显示在这里 -->
                </div>
                
                <div class="empty-state" id="recommended-empty">
                    <div class="empty-icon">⭑</div>
                    <div class="empty-text">暂无推荐的文案</div>
                    <button class="generate-btn" onclick="switchPage('home')">去生成文案</button>
                </div>
            </div>
        </div>
        
        <!-- 底部导航 -->
        <div class="nav">
            <div class="nav-item active" data-page="home">
                <span class="nav-icon">⚡</span>
                <div>生成</div>
            </div>
            <div class="nav-item" data-page="likes">
                <span class="nav-icon">♥</span>
                <div>我的喜欢</div>
            </div>
            <div class="nav-item" data-page="collections">
                <span class="nav-icon">☆</span>
                <div>我的收藏</div>
            </div>
            <div class="nav-item" data-page="recommendations">
                <span class="nav-icon">⭑</span>
                <div>馆内推荐</div>
            </div>
        </div>
        
        <div class="footer">
            ©星期天文案馆专属
        </div>
        
        <div class="toast" id="toast">文案已复制到剪贴板</div>
    </div>

    <script>
        // 全局变量
        let likedCopies = [];
        let collectedCopies = [];
        let recommendedCopies = [];
        let usedIndexes = [];
        
        // 1. 升级网感文案模板库：融入流行表达、情绪共鸣、场景化描述
        const highQualityTemplates = [
            // 自拍类：强调「颜值、状态、氛围感」
            "今日份自拍加载完毕✨ 颜值和心情都在线",
            "对着镜头比个耶～ 快乐不需要滤镜📸",
            "角度找对，自拍翻倍！今天也是被自己美到的一天💖",
            "自拍的意义：记录每一个「我超棒」的瞬间🌟",
            "原相机直出也敢发！状态好到不用P图的快乐谁懂啊～",
            
            // 时光/日常类：加入「松弛感、小确幸、治愈」等网感词汇
            "生活不是选择，是热爱～ 慢下来才发现处处是小确幸🌿",
            "时间会过滤掉不开心，留下的全是温柔呀💫",
            "把日子过成自己喜欢的样子，每天都是限定款✨",
            "不需要追赶别人的脚步，我的节奏就很好呀～",
            "平凡的日子里，藏着最踏实的幸福🥂",
            
            // 入秋类：结合「季节仪式感、氛围感」
            "秋风一吹，所有的温柔都有了归处🍂",
            "入秋的第一杯热饮+第一件针织衫，仪式感拉满！",
            "秋天是慢慢变冷的，快乐是突然出现的～ 🍁",
            "和夏天说再见，和温柔的秋天撞个满怀🌾",
            "落叶知秋，微风徐来，所有美好都不期而遇",
            
            // 周末类：强调「松弛、躺平、治愈」
            "周末模式开启：不赶时间，不赶进度，只赶快乐🚶‍♀️",
            "周末的意义：把生活还给自己，把快乐还给心情～",
            "宅家躺平的周末，比任何社交都治愈💤",
            "周末不用闹钟的快乐，谁懂啊！自然醒yyds✨",
            "约上好友逛吃逛吃～ 周末就是要尽兴呀🥳",
            
            // 咖啡/美食类：突出「续命、治愈、幸福感」
            "咖啡续命的一天☕ 一口下去，清醒又治愈",
            "美食是快乐的开关！吃到好吃的瞬间，所有烦恼都消失了🍰",
            "不是在喝咖啡，就是在去买咖啡的路上～ 打工人的续命神器✨",
            "好好吃饭，好好生活，人间烟火气最抚凡人心呀🍜",
            "今日份碳水快乐已签收！长胖什么的明天再考虑吧～",
            
            // 通用治愈类：融入「懂、谁懂、yyds、绝绝子」等社交高频词
            "治愈自己的方式有很多，比如今天的阳光和你💖",
            "不需要很完美，做自己就好呀～ 你已经很棒了！",
            "把烦恼丢进风里，今天只负责开心✨",
            "快乐不需要理由，比如此刻的微风和好听的歌🎵",
            "生活偶尔有点难，但还好有很多小美好在撑腰呀～"
        ];
        
        // 2. 升级情感关键词映射：增加「网感属性词」（如续命、松弛、氛围感）
        const emotionKeywords = {
            "自拍": ["颜值", "状态", "氛围感", "镜头感", "原相机", "滤镜", "比耶", "快乐"],
            "时光": ["治愈", "温柔", "小确幸", "松弛感", "限定款", "回忆", "踏实", "热爱"],
            "入秋": ["仪式感", "温柔", "落叶", "热饮", "针织衫", "微风", "不期而遇", "金黄"],
            "周末": ["躺平", "治愈", "逛吃", "自然醒", "尽兴", "松弛", "快乐", "宅家"],
            "咖啡": ["续命", "清醒", "治愈", "打工人", "醇香", "仪式感", "提神", "放松"],
            "citywalk": ["漫游", "自在", "街头", "烟火气", "探索", "松弛", "随手拍", "治愈"],
            "美食": ["快乐开关", "碳水快乐", "人间烟火", "好吃到爆", "幸福感", "解馋", "满足"],
            "宅家": ["躺平", "治愈", "追剧", "放松", "舒适", "自在", "不被打扰", "惬意"]
        };
        
        // 3. 升级文案结构模板：加入「网感句式」（如谁懂啊、yyds、不需要...只需要...）
        const structureTemplates = [
            "{主题}的快乐谁懂啊！{情感}直接拉满✨",
            "今日份{主题}已上线～ {情感}感绝了！",
            "不需要{无关词}，只需要{主题}带来的{情感}就够啦～",
            "{主题}yyds！{情感}到不想结束🥳",
            "关于{主题}，我的理解是：{情感}+快乐💖",
            "{主题}时间到！把{情感}焊在身上的一天～",
            "被{主题}治愈的一天，{情感}值直接拉满🌟",
            "{主题}不是任务，是{情感}的日常呀～",
            "解锁{主题}新姿势！{情感}感直接溢出屏幕📸",
            "{主题}的意义：记录每一个{情感}的瞬间✨"
        ];
        
        // 4. 新增：无关词库（用于结构模板中「不需要...」句式，增强网感）
        const irrelevantWords = ["内卷", "焦虑", "赶时间", "讨好别人", "完美主义", "压力"];
        
        // 5. 新增：场景化标签库（自动为文案添加#话题标签，提升社交传播性）
        const topicTags = {
            "自拍": ["#自拍日常", "#颜值分享", "#今日状态"],
            "时光": ["#生活感悟", "#小确幸", "#治愈系"],
            "入秋": ["#秋日氛围感", "#入秋仪式感", "#秋天文案"],
            "周末": ["#周末快乐", "#躺平日常", "#松弛感生活"],
            "咖啡": ["#咖啡续命", "#打工人日常", "#治愈咖啡"],
            "citywalk": ["#城市漫游", "#街头烟火", "#citywalk日记"],
            "美食": ["#美食打卡", "#碳水快乐", "#人间烟火气"],
            "宅家": ["#宅家日常", "#治愈宅家", "#周末宅家"]
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            // 从本地存储加载数据
            loadSavedData();
            
            // 页面导航
            const navItems = document.querySelectorAll('.nav-item');
            const pages = document.querySelectorAll('.page');
            const toast = document.getElementById('toast');
            
            // 初始化页面状态
            let currentPage = 'home';
            
            // 导航点击事件
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const pageId = this.getAttribute('data-page');
                    switchPage(pageId);
                });
            });
            
            // 切换页面函数
            function switchPage(pageId) {
                // 更新导航状态
                navItems.forEach(nav => nav.classList.remove('active'));
                document.querySelector(`.nav-item[data-page="${pageId}"]`).classList.add('active');
                
                // 显示对应页面
                pages.forEach(page => {
                    page.classList.remove('active');
                    if (page.id === pageId) {
                        page.classList.add('active');
                    }
                });
                
                currentPage = pageId;
                
                // 如果切换到保存的页面，更新内容
                if (pageId === 'likes') {
                    updateSavedResults('likes');
                } else if (pageId === 'collections') {
                    updateSavedResults('collections');
                } else if (pageId === 'recommendations') {
                    updateSavedResults('recommendations');
                }
            }
            
            // 关键词点击：优化关键词重复添加问题
            const keywords = document.querySelectorAll('.keyword');
            const inputField = document.querySelector('.input-field');
            
            keywords.forEach(keyword => {
                keyword.addEventListener('click', function() {
                    const currentText = inputField.value.trim();
                    const tagText = this.textContent;
                    // 避免重复添加同一关键词
                    if (!currentText.split(/\s+/).includes(tagText)) {
                        inputField.value = currentText 
                            ? `${currentText} ${tagText}` 
                            : tagText;
                    }
                    inputField.focus();
                });
            });
            
            // 生成文案
            const generateBtn = document.querySelector('.generate-btn');
            const resultsContainer = document.querySelector('.results');
            const regenerateBtn = document.querySelector('.regenerate');
            const loading = document.querySelector('.loading');
            
            generateBtn.addEventListener('click', generateCopy);
            regenerateBtn.addEventListener('click', generateCopy);
            
            // 输入框回车生成（增强便捷性）
            inputField.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    generateCopy();
                }
            });
            
            function generateCopy() {
                const userInput = inputField.value || "美好时光";
                const keywords = extractKeywords(userInput);
                
                // 显示加载中
                loading.style.display = 'block';
                resultsContainer.style.display = 'none';
                regenerateBtn.style.display = 'none';
                
                // 模拟AI思考时间
                setTimeout(() => {
                    // 隐藏加载中
                    loading.style.display = 'none';
                    
                    // 清空之前的结果
                    resultsContainer.innerHTML = '';
                    
                    // 重置已使用索引
                    usedIndexes = [];
                    
                    // 生成10条文案
                    for (let i = 0; i < 10; i++) {
                        const { copy, tag } = generateSmartCopy(keywords, i); // 新增标签返回
                        
                        const resultItem = document.createElement('div');
                        resultItem.className = 'result-item';
                        resultItem.style.animationDelay = `${i * 0.1}s`;
                        resultItem.dataset.text = copy; // 仅存储文案主体，排除标签
                        
                        // 检查是否已经喜欢/收藏/推荐
                        const isLiked = likedCopies.includes(copy);
                        const isCollected = collectedCopies.includes(copy);
                        const isRecommended = recommendedCopies.includes(copy);
                        
                        // 文案+标签组合渲染
                        resultItem.innerHTML = `
                            <div class="result-text">${copy}</div>
                            ${tag ? `<span class="result-tag">${tag}</span>` : ''}
                            <div class="result-actions">
                                <button class="action-btn copy-btn"><i>📋</i> 复制</button>
                                <button class="action-btn like-btn ${isLiked ? 'active' : ''}"><i>♥</i> 喜欢</button>
                                <button class="action-btn collect-btn ${isCollected ? 'active' : ''}"><i>☆</i> 收藏</button>
                                <button class="action-btn recommend-btn ${isRecommended ? 'active' : ''}"><i>⭑</i> 推荐</button>
                            </div>
                        `;
                        
                        resultsContainer.appendChild(resultItem);
                    }
                    
                    // 显示结果区域
                    resultsContainer.style.display = 'block';
                    regenerateBtn.style.display = 'block';
                    
                    // 添加事件监听器到新生成的按钮
                    attachEventListeners();
                }, 1500);
            }
            
            // 提取关键词：优化关键词过滤逻辑，保留英文关键词（如citywalk）
            function extractKeywords(input) {
                const words = input.split(/[\s,，、；;。.！!？?]+/);
                const extracted = [];
                
                for (const word of words) {
                    const trimmedWord = word.trim();
                    // 保留2字及以上中文/英文关键词（如citywalk、自拍）
                    if (trimmedWord.length >= 2 && !extracted.includes(trimmedWord)) {
                        extracted.push(trimmedWord);
                    }
                }
                
                return extracted.length > 0 ? extracted : ["生活"];
            }
            
            // 2. 升级智能生成逻辑：增加「标签自动匹配、句式灵活组合」
            function generateSmartCopy(keywords, index) {
                // 分析关键词情感
                const emotions = analyzeEmotions(keywords);
                // 匹配对应话题标签
                const tag = getTopicTag(keywords);
                
                // 提升高质量模板使用率（从30%→50%），确保网感文案占比更高
                if (Math.random() < 0.5 && highQualityTemplates.length > 0) {
                    let selectedIndex;
                    do {
                        selectedIndex = Math.floor(Math.random() * highQualityTemplates.length);
                    } while (usedIndexes.includes(selectedIndex) && usedIndexes.length < highQualityTemplates.length);
                    
                    usedIndexes.push(selectedIndex);
                    return {
                        copy: highQualityTemplates[selectedIndex],
                        tag: tag
                    };
                }
                
                // 生成自定义网感文案
                const template = structureTemplates[Math.floor(Math.random() * structureTemplates.length)];
                
                // 获取相关情感词
                let emotionWords = [];
                for (const keyword of keywords) {
                    if (emotionKeywords[keyword]) {
                        emotionWords = emotionWords.concat(emotionKeywords[keyword]);
                    }
                }
                
                // 如果没有找到相关情感词，使用通用网感情感词
                if (emotionWords.length === 0) {
                    emotionWords = ["快乐", "治愈", "松弛", "氛围感", "小确幸", "yyds", "绝绝子", "限定款"];
                }
                
                // 随机选择情感词、主题词、无关词
                const emotion = emotionWords[Math.floor(Math.random() * emotionWords.length)];
                const theme = keywords[Math.floor(Math.random() * keywords.length)];
                const irrelevant = irrelevantWords[Math.floor(Math.random() * irrelevantWords.length)];
                
                // 填充模板（替换{无关词}）
                let copy = template
                    .replace(/{主题}/g, theme)
                    .replace(/{情感}/g, emotion)
                    .replace(/{无关词}/g, irrelevant);
                
                // 提升emoji使用率（从50%→80%），增强视觉网感
                if (Math.random() < 0.8) {
                    const emojis = ["✨", "💫", "🌟", "💖", "🥂", "🌿", "📸", "🎁", "🍂", "☕", "🍰", "🚶‍♀️", "🥳", "🎵"];
                    // 避免emoji重复添加（如果模板已有则不重复）
                    if (!copy.includes(emojis.find(e => copy.includes(e)))) {
                        copy += " " + emojis[Math.floor(Math.random() * emojis.length)];
                    }
                }
                
                return {
                    copy: copy,
                    tag: tag
                };
            }
            
            // 3. 升级情感分析：增加「场景化情感匹配」（如citywalk→漫游、自在）
            function analyzeEmotions(keywords) {
                const emotions = [];
                
                for (const keyword of keywords) {
                    if (["自拍", "照片", "镜头"].includes(keyword)) {
                        emotions.push("颜值", "氛围感", "镜头感", "快乐", "自信");
                    } else if (["时光", "时间", "日常"].includes(keyword)) {
                        emotions.push("治愈", "松弛", "小确幸", "温柔", "限定款");
                    } else if (["入秋", "秋天", "落叶"].includes(keyword)) {
                        emotions.push("仪式感", "温柔", "不期而遇", "金黄", "治愈");
                    } else if (["周末", "休息", "宅家"].includes(keyword)) {
                        emotions.push("躺平", "松弛", "自然醒", "治愈", "尽兴");
                    } else if (["咖啡", "美食", "饮品"].includes(keyword)) {
                        emotions.push("续命", "治愈", "幸福感", "快乐", "满足");
                    } else if (["citywalk", "漫游", "街头"].includes(keyword)) {
                        emotions.push("自在", "探索", "烟火气", "松弛", "治愈");
                    } else {
                        emotions.push("快乐", "治愈", "松弛", "氛围感", "小确幸");
                    }
                }
                
                return emotions;
            }
            
            // 新增：根据关键词匹配话题标签
            function getTopicTag(keywords) {
                for (const keyword of keywords) {
                    if (topicTags[keyword]) {
                        return topicTags[keyword][Math.floor(Math.random() * topicTags[keyword].length)];
                    }
                }
                // 默认标签
                return "#生活记录";
            }
            
            // 为按钮添加事件监听器
            function attachEventListeners() {
                // 复制功能：优化复制内容（包含标签，提升实用性）
                document.querySelectorAll('.copy-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const text = this.parentElement.previousElementSibling?.classList.contains('result-tag')
                            ? `${this.parentElement.previousElementSibling.previousElementSibling.textContent} ${this.parentElement.previousElementSibling.textContent}`
                            : this.parentElement.previousElementSibling.textContent;
                        copyToClipboard(text);
                        
                        // 显示提示
                        showToast('文案已复制到剪贴板');
                    });
                });
                
                // 喜欢功能
                document.querySelectorAll('.like-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const item = this.closest('.result-item');
                        const text = item.dataset.text; // 仅存储文案主体，避免标签重复
                        
                        if (this.classList.contains('active')) {
                            // 取消喜欢
                            likedCopies = likedCopies.filter(copy => copy !== text);
                            this.classList.remove('active');
                            showToast('取消喜欢');
                        } else {
                            // 添加喜欢
                            if (!likedCopies.includes(text)) {
                                likedCopies.push(text);
                            }
                            this.classList.add('active');
                            showToast('已喜欢');
                        }
                        
                        // 保存到本地存储
                        saveToLocalStorage();
                    });
                });
                
                // 收藏功能
                document.querySelectorAll('.collect-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const item = this.closest('.result-item');
                        const text = item.dataset.text;
                        
                        if (this.classList.contains('active')) {
                            // 取消收藏
                            collectedCopies = collectedCopies.filter(copy => copy !== text);
                            this.classList.remove('active');
                            showToast('取消收藏');
                        } else {
                            // 添加收藏
                            if (!collectedCopies.includes(text)) {
                                collectedCopies.push(text);
                            }
                            this.classList.add('active');
                            showToast('已收藏');
                        }
                        
                        // 保存到本地存储
                        saveToLocalStorage();
                    });
                });
                
                // 推荐功能
                document.querySelectorAll('.recommend-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const item = this.closest('.result-item');
                        const text = item.dataset.text;
                        
                        if (this.classList.contains('active')) {
                            // 取消推荐
                            recommendedCopies = recommendedCopies.filter(copy => copy !== text);
                            this.classList.remove('active');
                            showToast('取消推荐');
                        } else {
                            // 添加推荐
                            if (!recommendedCopies.includes(text)) {
                                recommendedCopies.push(text);
                            }
                            this.classList.add('active');
                            showToast('已推荐');
                        }
                        
                        // 保存到本地存储
                        saveToLocalStorage();
                    });
                });
            }
            
            // 复制到剪贴板：优化兼容性
            function copyToClipboard(text) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    // 优先使用现代API
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(text).then(() => {
                            console.log('复制成功');
                        }).catch(err => {
                            document.execCommand('copy');
                        });
                    } else {
                        document.execCommand('copy');
                    }
                } catch (err) {
                    console.error('无法复制文本: ', err);
                    showToast('复制失败，请手动复制');
                }
                
                document.body.removeChild(textarea);
            }
            
            // 显示提示消息
            function showToast(message) {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 2000);
            }
            
            // 保存数据到本地存储
            function saveToLocalStorage() {
                localStorage.setItem('likedCopies', JSON.stringify(likedCopies));
                localStorage.setItem('collectedCopies', JSON.stringify(collectedCopies));
                localStorage.setItem('recommendedCopies', JSON.stringify(recommendedCopies));
            }
            
            // 从本地存储加载数据
            function loadSavedData() {
                const liked = localStorage.getItem('likedCopies');
                const collected = localStorage.getItem('collectedCopies');
                const recommended = localStorage.getItem('recommendedCopies');
                
                if (liked) likedCopies = JSON.parse(liked);
                if (collected) collectedCopies = JSON.parse(collected);
                if (recommended) recommendedCopies = JSON.parse(recommended);
            }
            
            // 更新保存的结果页面：显示文案时保留标签
            function updateSavedResults(type) {
                let copies = [];
                let containerId = '';
                let emptyId = '';
                
                if (type === 'likes') {
                    copies = likedCopies;
                    containerId = 'liked-results';
                    emptyId = 'liked-empty';
                } else if (type === 'collections') {
                    copies = collectedCopies;
                    containerId = 'collected-results';
                    emptyId = 'collected-empty';
                } else if (type === 'recommendations') {
                    copies = recommendedCopies;
                    containerId = 'recommended-results';
                    emptyId = 'recommended-empty';
                }
                
                const container = document.getElementById(containerId);
                const emptyState = document.getElementById(emptyId);
                
                // 清空容器
                container.innerHTML = '';
                
                if (copies.length === 0) {
                    // 显示空状态
                    emptyState.style.display = 'block';
                    container.style.display = 'none';
                } else {
                    // 隐藏空状态
                    emptyState.style.display = 'none';
                    container.style.display = 'block';
                    
                    // 添加保存的文案（匹配标签）
                    copies.forEach((copy, index) => {
                        // 提取文案中的关键词，匹配标签
                        const keywords = extractKeywords(copy);
                        const tag = getTopicTag(keywords);
                        
                        const resultItem = document.createElement('div');
                        resultItem.className = 'result-item';
                        resultItem.style.animationDelay = `${index * 0.1}s`;
                        resultItem.innerHTML = `
                            <div class="result-text">${copy}</div>
                            ${tag ? `<span class="result-tag">${tag}</span>` : ''}
                            <div class="result-actions">
                                <button class="action-btn copy-btn"><i>📋</i> 复制</button>
                                <button class="action-btn remove-btn"><i>❌</i> 移除</button>
                            </div>
                        `;
                        
                        container.appendChild(resultItem);
                    });
                    
                    // 为复制按钮添加事件监听
                    container.querySelectorAll('.copy-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const text = this.parentElement.previousElementSibling?.classList.contains('result-tag')
                                ? `${this.parentElement.previousElementSibling.previousElementSibling.textContent} ${this.parentElement.previousElementSibling.textContent}`
                                : this.parentElement.previousElementSibling.textContent;
                            copyToClipboard(text);
                            showToast('文案已复制到剪贴板');
                        });
                    });
                    
                    // 为移除按钮添加事件监听
                    container.querySelectorAll('.remove-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const item = this.closest('.result-item');
                            const text = item.querySelector('.result-text').textContent;
                            
                            if (type === 'likes') {
                                likedCopies = likedCopies.filter(copy => copy !== text);
                            } else if (type === 'collections') {
                                collectedCopies = collectedCopies.filter(copy => copy !== text);
                            } else if (type === 'recommendations') {
                                recommendedCopies = recommendedCopies.filter(copy => copy !== text);
                            }
                            
                            // 更新UI
                            item.remove();
                            
                            // 如果所有项目都被移除，显示空状态
                            if (container.children.length === 0) {
                                emptyState.style.display = 'block';
                                container.style.display = 'none';
                            }
                            
                            // 保存到本地存储
                            saveToLocalStorage();
                            
                            showToast('已移除');
                        });
                    });
                }
            }
            
            // 初始化页面
            switchPage('home');
        });
    </script>
</body>
</html>
